module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},41528,(e,t,r)=>{function a(e,t,r,a){return Math.round(e/r)+" "+a+(t>=1.5*r?"s":"")}t.exports=function(e,t){t=t||{};var r,s,n,i,o=typeof e;if("string"===o&&e.length>0){var d=e;if(!((d=String(d)).length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(l){var c=parseFloat(l[1]);switch((l[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*c;case"weeks":case"week":case"w":return 6048e5*c;case"days":case"day":case"d":return 864e5*c;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*c;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*c;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:break}}}return}if("number"===o&&isFinite(e)){return t.long?(s=Math.abs(r=e))>=864e5?a(r,s,864e5,"day"):s>=36e5?a(r,s,36e5,"hour"):s>=6e4?a(r,s,6e4,"minute"):s>=1e3?a(r,s,1e3,"second"):r+" ms":(i=Math.abs(n=e))>=864e5?Math.round(n/864e5)+"d":i>=36e5?Math.round(n/36e5)+"h":i>=6e4?Math.round(n/6e4)+"m":i>=1e3?Math.round(n/1e3)+"s":n+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},24868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},72640,(e,t,r)=>{"use strict";var a,s=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,s)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=e.e&&e.e.__importStar||(a=function(e){return(a=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=a(e),i=0;i<r.length;i++)"default"!==r[i]&&s(t,e,r[i]);return n(t,e),t});Object.defineProperty(r,"__esModule",{value:!0}),r.validateItem=r.createSchema=r.saveWithSchema=r.save=r.readWithSchema=r.read=r.deleteByIdAsync=r.saveBulkAsync=r.readAllAsync=r.readByIdAsync=r.snapshotCollection=r.compactCollection=r.configure=void 0;let o=i(e.r(22734)),d=i(e.r(14747)),l=i(e.r(24868)),c=e.r(22734),u=i(e.r(6461)),p="./data",f="./snapshots",h={maxItemsPerShard:1e5,maxBytesPerShard:0x6400000};r.configure=e=>{e.maxItemsPerShard&&e.maxItemsPerShard>0&&(h.maxItemsPerShard=e.maxItemsPerShard),e.maxBytesPerShard&&e.maxBytesPerShard>1048576&&(h.maxBytesPerShard=e.maxBytesPerShard)};let m=(e,t)=>{switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"object":return"object"==typeof e&&null!==e&&!Array.isArray(e);case"array":return Array.isArray(e);case"any":return!0;default:return!1}},y=(e,t)=>{if(!t)return{isValid:!0,errors:[]};let a=[];return e.forEach((e,s)=>{let n=(0,r.validateItem)(e,t);n.isValid||n.errors.forEach(e=>{a.push(`Item ${s}: ${e}`)})}),{isValid:0===a.length,errors:a}},w=e=>{let t=d.resolve(p),r=d.resolve(p,e);if(!r.startsWith(t))throw Error("Invalid file path");return d.basename(r)},g=()=>{o.existsSync(p)||o.mkdirSync(p,{mode:448})},v=async()=>{try{await l.mkdir(f,{recursive:!0,mode:448})}catch(e){}},S=new Map,x=async(e,t)=>{var r;let a,s=null!=(r=S.get(e))?r:Promise.resolve(),n=new Promise(e=>{a=e});S.set(e,s.then(()=>n));try{let r=await t();return a(void 0),S.get(e)===n&&S.delete(e),r}catch(t){throw a(void 0),S.get(e)===n&&S.delete(e),t}},b=e=>d.basename(e).replace(/\.json$/i,""),A=e=>d.join(p,e),j=e=>d.join(A(e),"meta.json"),R=e=>d.join(A(e),"wal"),I=e=>d.join(A(e),"byId.idx.json"),_=(e,t)=>d.join(A(e),`${String(t).padStart(5,"0")}.ndjson`),O=async e=>{try{await l.mkdir(A(e),{recursive:!0,mode:448})}catch(e){}},E=async(e,t)=>{try{let t=await l.readFile(e,"utf8");return JSON.parse(t)}catch(e){return t}},N=async(e,t)=>{let r=`${e}.tmp`;await l.writeFile(r,JSON.stringify(t,null,2),{encoding:"utf8",mode:384}),await l.rename(r,e)},P=async e=>{await l.mkdir(p,{recursive:!0,mode:448}),await O(e);let t=j(e),r=await E(t,{collection:e,activeShard:"00001.ndjson",shards:[],updatedAt:new Date().toISOString()});if(0===r.shards.length){let a=_(e,1);try{await l.access(a)}catch(e){await l.writeFile(a,"",{encoding:"utf8",mode:384})}let s=await l.stat(a);r.activeShard=d.basename(a),r.shards=[{name:d.basename(a),count:0,size:s.size}],r.updatedAt=new Date().toISOString(),await N(t,r)}return r},k=async e=>await E(I(e),{key:"id",map:{},updatedAt:new Date().toISOString()}),C=async(e,t)=>{t.updatedAt=new Date().toISOString(),await N(I(e),t)},D=async(e,t)=>{let r=0;try{r=(await l.stat(e)).size}catch(e){r=0}let a=JSON.stringify(t)+"\n";return await l.appendFile(e,a,{encoding:"utf8"}),r},F=async(e,t)=>{let r=R(e);return await O(e),D(r,t)},$=async e=>{let t=R(e);try{let e=await l.readFile(t,"utf8");if(!e)return[];return e.split(/\n/).filter(Boolean).map(e=>JSON.parse(e))}catch(e){return[]}};r.compactCollection=async e=>{let t=b(e);await x(t,async()=>{let e,r=await P(t),a=await k(t),s=await $(t);if(0===s.length)return;let n=new Map;for(let e of s)n.set(e.id,e);let i=((e=r.activeShard.match(/-(\d+)\.ndjson$/))?parseInt(e[1],10):1)+1-1+1,o=d.basename(_(t,i)),c=_(t,i);await l.writeFile(c,"",{encoding:"utf8",mode:384});let u=0;for(let[,e]of n)if("upsert"===e.op&&e.doc){let t=await D(c,e.doc);a.map[e.id]={file:o,offset:t},u++}else"delete"===e.op&&(a.map[e.id]={file:o,offset:-1,deleted:!0});let p=await l.stat(c);r.shards.unshift({name:o,count:u,size:p.size}),r.activeShard=o,r.updatedAt=new Date().toISOString(),await N(j(t),r),await C(t,a),await l.writeFile(R(t),"",{encoding:"utf8",mode:384})})},r.snapshotCollection=async(e,t=7)=>{let r=b(e);await v();let a=new Date,s=`${r}-snapshot-${a.getFullYear()}${String(a.getMonth()+1).padStart(2,"0")}${String(a.getDate()).padStart(2,"0")}-${String(a.getHours()).padStart(2,"0")}${String(a.getMinutes()).padStart(2,"0")}${String(a.getSeconds()).padStart(2,"0")}`,n=d.join(f,s);await l.mkdir(n,{recursive:!0,mode:448});let i=j(r),o=R(r),c=I(r),h=async e=>{try{let t=d.basename(e),r=d.join(n,`${t}.gz`),a=await l.readFile(e),s=u.gzipSync(a);await l.writeFile(r,s,{mode:384})}catch(e){}};await h(i),await h(o),await h(c);try{for(let e of(await E(i,{collection:r,activeShard:"",shards:[],updatedAt:""})).shards)await h(d.join(p,e.name))}catch(e){}try{let e=(await l.readdir(f,{withFileTypes:!0})).filter(e=>e.isDirectory()&&e.name.startsWith(`${r}-snapshot-`)).map(e=>e.name).sort();if(e.length>t)for(let r of e.slice(0,e.length-t))await l.rm(d.join(f,r),{recursive:!0,force:!0})}catch(e){}return n};let M=async(e,t,a)=>{let s=b(e),n=(await k(s)).map[t];if(n){if(n.deleted)return;let e=d.join(A(s),n.file);try{let t,s=await (t=n.offset,new Promise((r,a)=>{let s=(0,c.createReadStream)(e,{encoding:"utf8",start:t}),n="",i=()=>{if(n.length>0)try{r(JSON.parse(n))}catch(e){r(void 0)}else r(void 0)};s.on("data",e=>{let t=(n+="string"==typeof e?e:e.toString("utf8")).indexOf("\n");if(-1!==t){let e=n.slice(0,t);s.destroy();try{r(JSON.parse(e))}catch(e){r(void 0)}}}),s.on("error",e=>a(e)),s.on("close",i),s.on("end",i)}));if(a&&!(0,r.validateItem)(s,a).isValid)return;return s}catch(e){}}let i=await $(s);for(let e=i.length-1;e>=0;e--){let s=i[e];if(s.id===t){if("delete"===s.op||a&&!(0,r.validateItem)(s.doc,a).isValid)return;return s.doc}}};r.readByIdAsync=M;let q=async(e,t)=>{let a=b(e),s=await P(a),{schema:n,limit:i}=t||{},o=new Map;for(let e of(await $(a)))"delete"===e.op?o.set(e.id,null):e.doc&&(!n||(0,r.validateItem)(e.doc,n).isValid)&&o.set(e.id,e.doc);for(let e of s.shards){let t=d.join(A(a),e.name);try{let e=await l.readFile(t,"utf8");if(e){let t=e.split(/\n/).filter(Boolean);for(let e=t.length-1;e>=0;e--){let a=t[e];try{let e=JSON.parse(a),t=e&&e.id;if(void 0!==t&&!o.has(t)&&(!n||(0,r.validateItem)(e,n).isValid)&&(o.set(t,e),i&&o.size>=i))break}catch(e){}}}}catch(e){}if(i&&o.size>=i)break}let c=[];for(let[,e]of o)if(e&&c.push(e),i&&c.length>=i)break;return c};r.readAllAsync=q;let T=async(e,t,a,s)=>{let n=b(e),{strict:i=!1,skipInvalid:o=!1}=s||{},c=y(t,a);if(a&&!c.isValid&&i)throw Error(`Schema validation failed: ${c.errors.join(", ")}`);return await x(n,async()=>{let s=await P(n),i=await k(n),c=a&&o?t.filter(e=>(0,r.validateItem)(e,a).isValid):t;for(let e of c){let t=await F(n,{op:"upsert",id:e.id,doc:e,ts:Date.now()});i.map[e.id]={file:d.basename(R(n)),offset:t}}await C(n,i);try{let t=d.join(A(n),s.activeShard),a=await l.stat(t).catch(()=>({size:0})),i=await l.stat(R(n)).catch(()=>({size:0})),o=s.shards.length>0?s.shards[0].count:0;(a.size>=h.maxBytesPerShard||o+c.length>=h.maxItemsPerShard||i.size>=h.maxBytesPerShard/2)&&await (0,r.compactCollection)(e)}catch(e){}}),c};r.saveBulkAsync=T,r.deleteByIdAsync=async(e,t)=>{let r=b(e);await x(r,async()=>{let e=await k(r),a=await F(r,{op:"delete",id:t,ts:Date.now()});e.map[t]={file:d.basename(R(r)),offset:a,deleted:!0},await C(r,e)})},r.read=e=>{if(g(),!/^[a-zA-Z0-9_-]+\.json$/.test(e))throw Error("Invalid file name");let t=w(e),r=d.join(p,t);try{let e=b(t),r=o.existsSync(j(e)),a=o.existsSync(R(e));if(r||a)return(e=>{try{let t=b(e),r=JSON.parse(o.readFileSync(j(t),"utf8")),a=o.existsSync(R(t))?o.readFileSync(R(t),"utf8"):"",s=new Map;if(a)for(let e of a.split(/\n/).filter(Boolean))try{let t=JSON.parse(e);"delete"===t.op?s.set(t.id,null):t.doc&&s.set(t.id,t.doc)}catch(e){}for(let e of r.shards)try{let r=o.readFileSync(d.join(A(t),e.name),"utf8");if(!r)continue;let a=r.split(/\n/).filter(Boolean);for(let e=a.length-1;e>=0;e--)try{let t=JSON.parse(a[e]),r=t&&t.id;"string"!=typeof r&&"number"!=typeof r||s.has(r)||s.set(r,t)}catch(e){}}catch(e){}let n=[];for(let[,e]of s)e&&n.push(e);return n}catch(e){return[]}})(t)}catch(e){}try{o.existsSync(r)||o.writeFileSync(r,JSON.stringify([],null,2),{encoding:"utf8",mode:384});let e=o.readFileSync(r,"utf8"),t=JSON.parse(e);if(!Array.isArray(t))throw Error("Data is not an array");return t}catch(e){return console.error("Read error"),[]}},r.readWithSchema=(e,t)=>{let a=(0,r.read)(e),s=y(a,t);return t&&s.isValid,{data:a,validation:s}},r.save=(e,t)=>{if(g(),!/^[a-zA-Z0-9_-]+\.json$/.test(e))throw Error("Invalid file name");let r=w(e),a=d.join(p,r);try{if(!Array.isArray(t))throw Error("Data must be an array");if(0===t.length||t.every(e=>e&&"object"==typeof e&&"id"in e&&("string"==typeof e.id||"number"==typeof e.id)))return void((e,t)=>{let r=b(e);try{let e=R(r);g();try{o.mkdirSync(A(r),{recursive:!0,mode:448})}catch(e){}for(let r of t){let t=JSON.stringify({op:"upsert",id:r.id,doc:r,ts:Date.now()})+"\n";o.appendFileSync(e,t,{encoding:"utf8"})}let a=I(r),s={key:"id",map:{},updatedAt:new Date().toISOString()};try{s=JSON.parse(o.readFileSync(a,"utf8"))}catch(e){}let n=d.basename(e);try{o.statSync(e).size}catch(e){}for(let e of t)s.map[e.id]={file:n,offset:0};o.writeFileSync(a,JSON.stringify(s,null,2),{encoding:"utf8",mode:384});let i=j(r);if(!o.existsSync(i)){let e=_(r,1);o.existsSync(e)||o.writeFileSync(e,"",{encoding:"utf8",mode:384});let t=o.statSync(e),a={collection:r,activeShard:d.basename(e),shards:[{name:d.basename(e),count:0,size:t.size}],updatedAt:new Date().toISOString()};o.writeFileSync(i,JSON.stringify(a,null,2),{encoding:"utf8",mode:384})}}catch(a){let r=d.join(p,e);try{o.writeFileSync(r,JSON.stringify(t,null,2),{encoding:"utf8",mode:384})}catch(e){}}})(r,t);o.writeFileSync(a,JSON.stringify(t,null,2),{encoding:"utf8",mode:384})}catch(e){console.error("Save error")}},r.saveWithSchema=(e,t,a,s)=>{let n=y(t,a),{strict:i=!1,skipInvalid:o=!1}=s||{};if(a&&!n.isValid){if(i)throw Error(`Schema validation failed: ${n.errors.join(", ")}`);if(o){let s=t.filter((e,t)=>(0,r.validateItem)(e,a).isValid);return(0,r.save)(e,s),n}}return(0,r.save)(e,t),n},r.createSchema=e=>e,r.validateItem=(e,t)=>{let r=[];for(let[a,s]of Object.entries(t)){if(s.required&&(void 0===e[a]||null===e[a])){r.push(`Field '${a}' is required`);continue}void 0!==e[a]&&null!==e[a]&&(m(e[a],s.type)||r.push(`Field '${a}' must be of type '${s.type}'`),s.validate&&!s.validate(e[a])&&r.push(`Field '${a}' failed custom validation`))}return{isValid:0===r.length,errors:r}}},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},89960,e=>{"use strict";var t=e.i(66680);let r={randomUUID:t.randomUUID},a=new Uint8Array(256),s=a.length,n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));e.s(["v4",0,function(e,i,o){if(r.randomUUID&&!i&&!e)return r.randomUUID();var d=e,l=o;let c=(d=d||{}).random??d.rng?.()??(s>a.length-16&&((0,t.randomFillSync)(a),s=0),a.slice(s,s+=16));if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,i){if((l=l||0)<0||l+16>i.length)throw RangeError(`UUID byte range ${l}:${l+15} is out of buffer bounds`);for(let e=0;e<16;++e)i[l+e]=c[e];return i}return function(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}(c)}],89960)},72599,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),i=e.i(74677),o=e.i(69741),d=e.i(16795),l=e.i(87718),c=e.i(95169),u=e.i(47587),p=e.i(66012),f=e.i(70101),h=e.i(26937),m=e.i(10372),y=e.i(93695);e.i(52474);var w=e.i(220),g=e.i(89171),v=e.i(72640),S=e.i(65617),x=e.i(24652),b=e.i(89960);let A=process.env.JWT_SECRET||"webshop_by_proleak",j=process.env.API_KEY_MIDDLE||"apikey",R="https://www.middle-pay.com";async function I(e){try{let t,r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return g.NextResponse.json({success:!1,message:"ไม่พบ token สำหรับการยืนยันตัวตน"},{status:401});let a=r.substring(7);try{t=x.default.verify(a,A)}catch(e){return g.NextResponse.json({success:!1,message:"Token ไม่ถูกต้อง"},{status:401})}let{product_key:s,item_sku:n,input:i,webhookURL:o}=await e.json();if(!s||!n||!i||!i.uid)return g.NextResponse.json({success:!1,message:"กรุณาระบุข้อมูลให้ครบถ้วน (product_key, item_sku, input.uid)"},{status:400});let d=(0,v.read)("users.json")||[],l=d.findIndex(e=>e.id===t.id);if(-1===l)return g.NextResponse.json({success:!1,message:"ไม่พบข้อมูลผู้ใช้"},{status:404});let c=d[l],u=c.balance||0,p=0;try{let e=await S.default.get(`${R}/api/v1/products/list`,{headers:{"X-API-Key":j}}),t=e.data?.find(e=>e.key===s);if(!t)return g.NextResponse.json({success:!1,message:"ไม่พบเกมที่ระบุ"},{status:404});let r=t.items?.find(e=>e.sku===n);if(!r)return g.NextResponse.json({success:!1,message:"ไม่พบไอเท็มที่ระบุ"},{status:404});if(p=parseFloat(r.price)||0,t.name,r.name,p<=0)return g.NextResponse.json({success:!1,message:"ราคาไอเท็มไม่ถูกต้อง"},{status:400})}catch(e){return console.error("Error fetching game details:",e),g.NextResponse.json({success:!1,message:"ไม่สามารถตรวจสอบข้อมูลเกมได้"},{status:500})}if(u<p)return g.NextResponse.json({success:!1,message:"ยอดเงินคงเหลือไม่เพียงพอ"},{status:400});let f=(0,b.v4)(),h={id:f,userId:t.id,productId:s,type:"topup_game",state:"processing",price:p,input:i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},m=(0,v.read)("orders.json")||[];m.push(h),(0,v.save)("orders.json",m);try{let e=(await S.default.post(`${R}/api/v1/agent/orders/create`,{product_key:s,item_sku:n,input:i,webhookURL:o},{headers:{"X-API-Key":j,"Content-Type":"application/json"}})).data;if(e.order){let r=m.findIndex(e=>e.id===f);-1!==r&&(m[r].transactionId=e.order.transactionId,m[r].state=e.order.state||"completed",m[r].input=e.order.input,m[r].productMetadata=e.order.productMetadata,m[r].createdAt=e.order.createdAt,m[r].updatedAt=e.order.updatedAt,m[r].finishedAt=e.order.finishedAt,m[r].result_code=e.order.result_code,(0,v.save)("orders.json",m));let a=u-p;return d[l].balance=a,(0,v.save)("users.json",d),g.NextResponse.json({success:!0,message:"สั่งซื้อสำเร็จ",data:{order:{transactionId:e.order.transactionId,price:e.order.price,userId:parseInt(t.id),state:e.order.state||"completed",input:e.order.input,productMetadata:e.order.productMetadata,createdAt:e.order.createdAt,updatedAt:e.order.updatedAt,finishedAt:e.order.finishedAt,result_code:e.order.result_code},user:{id:parseInt(t.id),username:c.username,balance:a.toString(),balance_used:p.toString()}}})}{let e=m.findIndex(e=>e.id===f);return -1!==e&&(m[e].state="failed",m[e].updatedAt=new Date().toISOString(),(0,v.save)("orders.json",m)),g.NextResponse.json({success:!1,message:"การสั่งซื้อล้มเหลว"},{status:500})}}catch(t){console.error("External API error:",t);let e=m.findIndex(e=>e.id===f);return -1!==e&&(m[e].state="failed",m[e].updatedAt=new Date().toISOString(),(0,v.save)("orders.json",m)),g.NextResponse.json({success:!1,message:"การสั่งซื้อล้มเหลว กรุณาลองใหม่อีกครั้ง"},{status:500})}}catch(e){return console.error("Topup buy error:",e),g.NextResponse.json({success:!1,message:"เกิดข้อผิดพลาดในการสั่งซื้อ"},{status:500})}}e.s(["POST",()=>I],72801);var _=e.i(72801);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/v1/topup/buy/route",pathname:"/api/v1/topup/buy",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/topup/buy/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:E,workUnitAsyncStorage:N,serverHooks:P}=O;function k(){return(0,a.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:N})}async function C(e,t,a){O.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/v1/topup/buy/route";g=g.replace(/\/index$/,"")||"/";let v=await O.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:S,params:x,nextConfig:b,parsedUrl:A,isDraftMode:j,prerenderManifest:R,routerServerContext:I,isOnDemandRevalidate:_,revalidateOnlyGenerated:E,resolvedPathname:N,clientReferenceManifest:P,serverActionsManifest:k}=v,C=(0,o.normalizeAppPath)(g),D=!!(R.dynamicRoutes[C]||R.routes[N]),F=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,A,!1):t.end("This page could not be found"),null);if(D&&!j){let e=!!R.routes[N],t=R.dynamicRoutes[C];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await F();throw new y.NoFallbackError}}let $=null;!D||O.isDev||j||($="/index"===($=N)?"/":$);let M=!0===O.isDev||!D,q=D&&!M;k&&P&&(0,i.setManifestsSingleton)({page:g,clientReferenceManifest:P,serverActionsManifest:k});let T=e.method||"GET",U=(0,n.getTracer)(),B=U.getActiveScopeSpan(),z={params:x,prerenderManifest:R,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,s)=>O.onRequestError(e,t,a,s,I)},sharedContext:{buildId:S}},J=new d.NodeNextRequest(e),H=new d.NodeNextResponse(t),V=l.NextRequestAdapter.fromNodeNextRequest(J,(0,l.signalFromNodeResponse)(t));try{let i=async e=>O.handle(V,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${T} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${T} ${g}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:r})=>{try{if(!o&&_&&E&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=z.renderOpts.fetchMetrics;let d=z.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=z.renderOpts.collectedTags;if(!D)return await (0,p.sendResponse)(J,H,n,z.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,a=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:_})},!1,I),t}},c=await O.handleResponse({req:e,nextConfig:b,cacheKey:$,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:E,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:o});if(!D)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",_?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),j&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&D||y.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(J,H,new Response(c.value.body,{headers:y,status:c.value.status||200})),null};B?await d(B):await U.withPropagatedContext(e.headers,()=>U.trace(c.BaseServerSpan.handleRequest,{spanName:`${T} ${g}`,kind:n.SpanKind.SERVER,attributes:{"http.method":T,"http.target":e.url}},d))}catch(t){if(t instanceof y.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:C,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:_})},!1,I),D)throw t;return await (0,p.sendResponse)(J,H,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>k,"routeModule",()=>O,"serverHooks",()=>P,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>N],72599)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e644dbfd._.js.map